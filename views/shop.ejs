<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50">
    <%- include("./partials/navber") %> <% if (success_msg.length > 0) { %>
    <div
      class="bg-green-100 absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 border border-green-400 text-green-700 px-4 py-2 rounded mb-4"
    >
      <%= success_msg %>
    </div>
    <% } %> <% if (error_msg.length > 0) { %>
    <div
      class="bg-red-100 absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 border border-red-400 text-red-700 px-4 py-2 rounded mb-4"
    >
      <%= error_msg %>
    </div>
    <% } %>
    <!-- Main Shop Layout -->
    <main
      class="max-w-7xl mx-auto mt-8 px-4 grid grid-cols-1 md:grid-cols-4 gap-6"
    >
      <!-- Left Sidebar -->
      <aside class="space-y-8 col-span-1">
        <!-- Sort By -->
        <div class="flex justify-end mb-6">
          <form action="/shop" method="GET">
            <label for="sort" class="mr-2 font-medium">Sort by:</label>
            <select
              name="sort"
              id="sort"
              onchange="this.form.submit()"
              class="px-4 py-2 border border-gray-300 rounded-md"
            >
              <option value="">Default</option>
              <option value="low" <%= sort === "low" ? "selected" : "" %> >Price: Low to High</option>
              <option value="high" <%= sort === "high" ? "selected" : "" %> >Price: High to Low</option>
            </select>
          </form>
        </div>


        <!-- All Products -->
        <div>
          <h2 class="text-lg font-semibold mb-2">All Products</h2>
          <ul class="text-gray-600 space-y-1">
            <li><a href="#" class="hover:text-blue-500">Men</a></li>
            <li><a href="#" class="hover:text-blue-500">Women</a></li>
            <li><a href="#" class="hover:text-blue-500">Children</a></li>
          </ul>
        </div>

        <!-- Discount Products -->
        <div>
          <h2 class="text-lg font-semibold mb-2">Discount Products</h2>
          <ul class="text-gray-600 space-y-1">
            <li><a href="#" class="hover:text-blue-500">Up to 30%</a></li>
            <li><a href="#" class="hover:text-blue-500">Clearance</a></li>
          </ul>
        </div>
      </aside>

      <!-- Product Cards Right Section -->
      <section class="col-span-1 md:col-span-3 space-y-10">
        <!-- Men Section -->
        <div>
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">
            Men's Products
          </h2>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
            <% manProducts.forEach(product => { %>
            <div
              class="bg-white shadow rounded-lg overflow-hidden flex flex-col justify-between"
            >
              <% if(product.image){ %>
              <img
                src="data:image/jpg;base64,<%= product.image.toString('base64') %>"
                class="w-full h-48 object-cover"
              />
              <% } else { %>
              <img
                src="<%= product.imageUrl %>"
                class="w-full h-48 object-cover"
              />
              <% } %>

              <div class="p-4 flex flex-col gap-2">
                <h3 class="font-medium text-gray-800"><%= product.name %></h3>
                  <%
                    const price = Number(product.price);
                    const discount = Number(product.discount);
                  %>

                  <p class="text-blue-600 font-semibold">
                    $<%= price - discount %>
                    <% if (discount > 0) { %>
                      <span class="line-through text-gray-400 ml-2">$<%= price %></span>
                     
                    <% } %>
                  </p>

                <!-- <p class="text-blue-600 font-semibold">$<%= product.price %></p> -->
                <p class="text-sm text-gray-500 capitalize">
                  <%= product.category %>
                </p>

                <!-- Add to Cart Form -->
                <form action="/cart/add" method="POST">
                  <input
                    type="hidden"
                    name="productId"
                    value="<%= product._id %>"
                  />
                  <button
                    type="submit"
                    class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition duration-200"
                  >
                    Add to Cart
                  </button>
                </form>
              </div>
            </div>
            <% }) %>
          </div>
        </div>

        <!-- Women's Section -->
        <div>
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">
            Women's Products
          </h2>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
            <% womanProducts.forEach(product => { %>
            <div class="bg-white shadow rounded-lg overflow-hidden">
              <% if(product.image){ %>
              <img
                src="data:image/jpg;base64,<%=  product.image.toString('base64') %>"
                class="w-full h-48 object-cover"
              />
              <% } else { %>
              <img
                src="<%=  product.imageUrl %>"
                class="w-full h-48 object-cover"
              />
              <% } %>

              <div class="p-4">
                <h3 class="font-medium text-gray-800"><%= product.name %></h3>
                  <% 
                    const price = Number(product.price);
                    const discount = Number(product.discount);
                  %>
                  <p class="text-blue-600 font-semibold">
                    $<%= price - discount %> 
                    <% if (discount > 0) { %>
                      <span class="line-through text-gray-400 ml-2">$<%= price   %></span>

                    <% } %>
                  </p>

                <p class="text-sm text-gray-500 capitalize">
                  <%= product.category %>
                </p>
                <form action="/cart/add" method="POST">
                  <input
                    type="hidden"
                    name="productId"
                    value="<%= product._id %>"
                  />
                  <button
                    type="submit"
                    class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition duration-200"
                  >
                    Add to Cart
                  </button>
                </form>
              </div>
            </div>
            <% }) %>
          </div>
        </div>

        <!-- Children Section -->
        <div>
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">
            Children's Products
          </h2>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
            <% childProducts.forEach(product => { %>
            <div class="bg-white shadow rounded-lg overflow-hidden">
              <% if(product.image){ %>
              <img
                src="data:image/jpg;base64,<%=  product.image.toString('base64') %>"
                class="w-full h-48 object-cover"
              />
              <% } else { %>
              <img
                src="<%=  product.imageUrl %>"
                class="w-full h-48 object-cover"
              />
              <% } %>

              <div class="p-4">
                <h3 class="font-medium text-gray-800"><%= product.name %></h3>
                <p class="text-blue-600 font-semibold">$<%= product.price %></p>
                <p class="text-sm text-gray-500 capitalize">
                  <%= product.category %>
                </p>
                <form action="/cart/add" method="POST">
                  <input
                    type="hidden"
                    name="productId"
                    value="<%= product._id %>"
                  />
                  <button
                    type="submit"
                    class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition duration-200"
                  >
                    Add to Cart
                  </button>
                </form>
              </div>
            </div>
            <% }) %>
          </div>
        </div>
      </section>
    </main>
    <%- include("./partials/footer") %>
  </body>
</html>
